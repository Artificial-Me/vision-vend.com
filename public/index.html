<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vision Vend</title>
    <meta name="description" content="Transform any display fridge into a self-checkout vending machine with Vision Vend's plug-and-play AI kit">
    
    <!-- THREE & GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Shaders must load before effects that use them -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/ShaderPass.js"></script>
    <!-- Post-processing effects -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <!-- Other utilities -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="grid-overlay"></div>
    <div id="canvas-container"></div>
    <div class="ui-overlay">
        <div class="hero-text">
            <h1>Vision Vend</h1>
            <p>Convert any display case or display fridge into a self-checkout vending machine</p>
            <a href="#" class="cta-button">Join The Collective</a>
        </div>
        <div class="info-panel">
            <h3>Plug & Play AI Kit</h3>
            <p>Vision + weight fusion, auto-checkout, 30-min install, zero code.</p>
        </div>
    </div>

    <!-- Lens Flare Shader -->
    <script type="x-shader/x-vertex" id="vertexshader">
        varying vec2 vUv;
        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    </script>
    <script type="x-shader/x-fragment" id="fragmentshader">
        uniform sampler2D tDiffuse;
        uniform vec2 u_lightPosition;
        uniform float u_intensity;
        varying vec2 vUv;
        void main() {
            vec2 a = vUv - u_lightPosition;
            float d = length(a);
            float l = 1.0 / (1.0 + 20.0 * d * d);
            vec4 dif = texture2D(tDiffuse, vUv);
            dif.rgb += l * u_intensity;
            gl_FragColor = dif;
        }
    </script>

    <script>
        // Verify THREE.CopyShader exists
        if (!THREE.CopyShader) {
          console.error('CopyShader failed to load');
          // Fallback: Define basic CopyShader if missing
          THREE.CopyShader = {
            uniforms: { 'tDiffuse': { value: null } },
            vertexShader: `
              varying vec2 vUv;
              void main() {
                vUv = uv;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
              }
            `,
            fragmentShader: `
              uniform sampler2D tDiffuse;
              varying vec2 vUv;
              void main() {
                gl_FragColor = texture2D(tDiffuse, vUv);
              }
            `,
          };
        }

        // Verify THREE.ShaderPass exists and is a constructor
        if (typeof THREE.ShaderPass !== 'function') {
          console.error('ShaderPass not loaded or not a constructor - falling back to basic implementation');
          THREE.ShaderPass = function(shader) {
            this.uniforms = THREE.UniformsUtils.clone(shader.uniforms);
            this.material = new THREE.ShaderMaterial({
              uniforms: this.uniforms,
              vertexShader: shader.vertexShader,
              fragmentShader: shader.fragmentShader
            });
            this.enabled = true;
            this.needsSwap = true;
          };
        }
    </script>

    <script src="script.js"></script>
</body>
</html>